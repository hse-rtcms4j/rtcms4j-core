openapi: 3.0.3
info:
  title: RTCMS4J Core-service API
  version: 1.0.0
servers:
  - url: /api/v1

security:
  - bearerAuth: [ ]

paths:
  ########################
  # Managing namespaces: #
  ########################
  /namespace:
    head:
      tags:
        - Core
      summary: Check access to all namespaces
      operationId: hasAccessToAllNamespaces
      responses:
        '204':
          description: Access granted
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: No access
          $ref: '#/components/responses/Forbidden'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '500':
          $ref: '#/components/responses/InternalServerError'
    get:
      tags:
        - Core
      summary: Get all namespaces
      operationId: findAllNamespaces
      parameters:
        - name: name
          description: Search by name param
          in: query
          required: false
          schema:
            type: string
        - name: pageable
          in: query
          required: false
          schema:
            $ref: '#/components/schemas/Pageable'
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PagedModelNamespaceDto'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '500':
          $ref: '#/components/responses/InternalServerError'
    post:
      tags:
        - Core
      summary: Create new namespace
      operationId: createNamespace
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NamespaceCreateRequest'
      responses:
        '201':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NamespaceDto'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /namespace/{nid}:
    get:
      tags:
        - Core
      summary: Get namespace
      operationId: getNamespace
      parameters:
        - name: nid
          description: Namespace id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NamespaceDto'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: NamespaceDto not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseDto'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      tags:
        - Core
      summary: Update namespace
      operationId: updateNamespace
      parameters:
        - name: nid
          description: Namespace id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NamespaceUpdateRequest'
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NamespaceDto'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: NamespaceDto not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseDto'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags:
        - Core
      summary: Delete namespace
      operationId: deleteNamespace
      parameters:
        - name: nid
          description: Namespace id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: Successful operation
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: NamespaceDto not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseDto'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /namespace/{nid}/admin:
    get:
      tags:
        - Core
      summary: Get namespace admins
      operationId: getNamespaceAdmins
      parameters:
        - name: nid
          description: Namespace id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserRoleDto'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /namespace/{nid}/admin/{uid}:
    post:
      tags:
        - Core
      summary: Add namespace admin
      operationId: addNamespaceAdmin
      parameters:
        - name: nid
          description: Namespace id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: uid
          description: User id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Successful operation
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseDto'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags:
        - Core
      summary: Remove namespace admin
      operationId: removeNamespaceAdmin
      parameters:
        - name: nid
          description: Namespace id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: uid
          description: User id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Successful operation
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: UserInfo not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseDto'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '500':
          $ref: '#/components/responses/InternalServerError'

  ##########################
  # Managing applications: #
  ##########################
  /namespace/{nid}/application:
    head:
      tags:
        - Core
      summary: Check access to namespace
      operationId: hasAccessToNamespace
      parameters:
        - name: nid
          description: Namespace id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: Access granted
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: No access
          $ref: '#/components/responses/Forbidden'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '500':
          $ref: '#/components/responses/InternalServerError'
    get:
      tags:
        - Core
      summary: Get all namespace applications
      operationId: findAllApplications
      parameters:
        - name: nid
          description: Namespace id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: name
          description: Search by name param
          in: query
          required: false
          schema:
            type: string
        - name: pageable
          in: query
          required: false
          schema:
            $ref: '#/components/schemas/Pageable'
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PagedModelApplicationDto'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '500':
          $ref: '#/components/responses/InternalServerError'
    post:
      tags:
        - Core
      summary: Create new namespace application
      operationId: createApplication
      parameters:
        - name: nid
          description: Namespace id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ApplicationCreateRequest'
      responses:
        '201':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApplicationDto'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /namespace/{nid}/application/{aid}:
    get:
      tags:
        - Core
      summary: Get namespace application
      operationId: getApplication
      parameters:
        - name: nid
          description: Namespace id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: aid
          description: Application id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApplicationDto'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: ApplicationDto not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseDto'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      tags:
        - Core
      summary: Update namespace application
      operationId: updateApplication
      parameters:
        - name: nid
          description: Namespace id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: aid
          description: Application id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ApplicationUpdateRequest'
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApplicationDto'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: ApplicationDto not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseDto'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags:
        - Core
      summary: Delete namespace application
      operationId: deleteApplication
      parameters:
        - name: nid
          description: Namespace id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: aid
          description: Application id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: Successful operation
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: ApplicationDto not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseDto'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /namespace/{nid}/application/{aid}/manager:
    get:
      tags:
        - Core
      summary: Get namespace application managers
      operationId: getApplicationManagers
      parameters:
        - name: nid
          description: Namespace id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: aid
          description: Application id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserRoleDto'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /namespace/{nid}/application/{aid}/manager/{uid}:
    post:
      tags:
        - Core
      summary: Add namespace application manager
      operationId: addApplicationManager
      parameters:
        - name: nid
          description: Namespace id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: aid
          description: Application id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: uid
          description: User id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Successful operation
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseDto'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags:
        - Core
      summary: Remove namespace application manager
      operationId: removeApplicationManager
      parameters:
        - name: nid
          description: Namespace id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: aid
          description: Application id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: uid
          description: User id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Successful operation
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: UserInfo not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseDto'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /namespace/{nid}/application/{aid}/client:
    get:
      tags:
        - Core
      summary: Get namespace application client
      operationId: getApplicationClient
      parameters:
        - name: nid
          description: Namespace id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: aid
          description: Application id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/KeycloakClientDto'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '500':
          $ref: '#/components/responses/InternalServerError'
    patch:
      tags:
        - Core
      summary: Rotate namespace application client
      operationId: rotateApplicationClientPassword
      parameters:
        - name: nid
          description: Namespace id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: aid
          description: Application id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: propagate
          description: Propagate rotated secret
          in: query
          required: true
          schema:
            type: boolean
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/KeycloakClientDto'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '500':
          $ref: '#/components/responses/InternalServerError'

  ############################
  # Managing configurations: #
  ############################
  /namespace/{nid}/application/{aid}/configuration:
    head:
      tags:
        - Core
      summary: Check access to all configurations under application under namespace
      operationId: hasAccessToApplication
      parameters:
        - name: nid
          description: Namespace id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: aid
          description: Application id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: Access granted
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: No access
          $ref: '#/components/responses/Forbidden'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '500':
          $ref: '#/components/responses/InternalServerError'
    get:
      tags:
        - Core
      summary: Get namespace application configurations
      operationId: findAllConfigurations
      parameters:
        - name: nid
          description: Namespace id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: aid
          description: Application id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: name
          description: Search by name param
          in: query
          required: false
          schema:
            type: string
        - name: pageable
          in: query
          required: false
          schema:
            $ref: '#/components/schemas/Pageable'
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PagedModelConfigurationDto'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '500':
          $ref: '#/components/responses/InternalServerError'
    post:
      tags:
        - Core
      summary: Create new namespace application configuration
      operationId: createConfiguration
      parameters:
        - name: nid
          description: Namespace id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: aid
          description: Application id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConfigurationDtoCreateRequest'
      responses:
        '201':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConfigurationDetailedDto'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /namespace/{nid}/application/{aid}/configuration/{cid}:
    get:
      tags:
        - Core
      summary: Get namespace application configuration
      operationId: getConfiguration
      parameters:
        - name: nid
          description: Namespace id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: aid
          description: Application id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: cid
          description: Configuration id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConfigurationDetailedDto'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: ConfigurationDto not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseDto'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      tags:
        - Core
      summary: Update namespace application configuration
      operationId: updateConfiguration
      parameters:
        - name: nid
          description: Namespace id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: aid
          description: Application id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: cid
          description: Configuration id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConfigurationDtoUpdateRequest'
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConfigurationDto'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags:
        - Core
      summary: Delete namespace application configuration
      operationId: deleteConfiguration
      parameters:
        - name: nid
          description: Namespace id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: aid
          description: Application id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: cid
          description: Configuration id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: Successful operation
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: ConfigurationDto not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseDto'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /namespace/{nid}/application/{aid}/configuration/{cid}/commit:
    get:
      tags:
        - Core
      summary: Get namespace application configuration commits
      operationId: getConfigurationCommits
      parameters:
        - name: nid
          description: Namespace id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: aid
          description: Application id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: cid
          description: Configuration id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: pageable
          in: query
          required: false
          schema:
            $ref: '#/components/schemas/Pageable'
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PagedModelConfigurationCommitDto'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '500':
          $ref: '#/components/responses/InternalServerError'
    post:
      tags:
        - Core
      summary: Commit namespace application configuration
      operationId: commitConfiguration
      parameters:
        - name: nid
          description: Namespace id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: aid
          description: Application id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: cid
          description: Configuration id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConfigurationCommitRequest'
      responses:
        '201':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConfigurationCommitDetailedDto'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /namespace/{nid}/application/{aid}/configuration/{cid}/commit/{ctid}:
    get:
      tags:
        - Core
      summary: Get namespace application configuration commit
      operationId: getConfigurationCommit
      parameters:
        - name: nid
          description: Namespace id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: aid
          description: Application id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: cid
          description: Configuration id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: ctid
          description: Commit id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConfigurationCommitDetailedDto'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: ConfigurationCommitDetailedDto not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseDto'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '500':
          $ref: '#/components/responses/InternalServerError'
    patch:
      tags:
        - Core
      summary: Apply namespace application configuration commit
      operationId: applyConfigurationCommit
      parameters:
        - name: nid
          description: Namespace id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: aid
          description: Application id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: cid
          description: Configuration id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: ctid
          description: Commit id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: Successful operation
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: ConfigurationCommitDetailedDto not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseDto'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags:
        - Core
      summary: Delete namespace application configuration commit
      operationId: deleteConfigurationCommit
      parameters:
        - name: nid
          description: Namespace id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: aid
          description: Application id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: cid
          description: Configuration id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: ctid
          description: Commit id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: Successful operation
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: ConfigurationCommitDetailedDto not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseDto'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '500':
          $ref: '#/components/responses/InternalServerError'

  ############################
  # Available resources: #
  ############################
  /available/namespaces:
    get:
      tags:
        - Core
      summary: "Find available namespaces"
      operationId: findAvailableNamespaces
      parameters:
        - name: name
          description: Search by name param
          in: query
          required: false
          schema:
            type: string
        - name: pageable
          in: query
          required: false
          schema:
            $ref: '#/components/schemas/Pageable'
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PagedModelNamespaceDto'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /available/applications:
    get:
      tags:
        - Core
      summary: "Find available  applications"
      operationId: findAvailableApplications
      parameters:
        - name: name
          description: Search by name param
          in: query
          required: false
          schema:
            type: string
        - name: pageable
          in: query
          required: false
          schema:
            $ref: '#/components/schemas/Pageable'
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PagedModelApplicationDto'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  responses:
    BadRequest:
      description: Wrong or unexpected
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponseDto'
    Unauthorized:
      description: Wrong token or authorization failed
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponseDto'
    MethodNotAllowed:
      description: Wrong method
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponseDto'
    Forbidden:
      description: Not enough permissions to access
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponseDto'
    InternalServerError:
      description: Error on server side
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponseDto'

  schemas:
    Pageable:
      description: minimal Pageable query parameters
      type: object
      properties:
        page:
          type: integer
          format: int64
        size:
          type: integer
          format: int64

    PageMetadata:
      type: object
      required:
        - size
        - number
        - totalElements
        - totalPages
      properties:
        size:
          type: integer
          format: int64
          description: The size of the page
        totalElements:
          type: integer
          format: int64
          description: The total number of elements
        totalPages:
          type: integer
          format: int64
          description: The total number of pages
        number:
          type: integer
          format: int64
          description: The current page number

    ErrorResponseDto:
      type: object
      required:
        - httpCode
        - httpStatus
      properties:
        httpCode:
          type: integer
          format: int32
        httpStatus:
          type: string
        detailCode:
          type: integer
          format: int32
        detailMessage:
          type: string

    ############################
    # Namespaces:
    ############################
    PagedModelNamespaceDto:
      type: object
      required:
        - content
        - page
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/NamespaceDto'
        page:
          $ref: '#/components/schemas/PageMetadata'

    NamespaceFieldName:
      type: string
      minLength: 1
      maxLength: 64

    NamespaceFieldDescription:
      type: string
      minLength: 0
      maxLength: 512

    NamespaceDto:
      type: object
      required:
        - id
        - name
        - description
      properties:
        id:
          type: integer
          format: int64
        name:
          $ref: '#/components/schemas/NamespaceFieldName'
        description:
          $ref: '#/components/schemas/NamespaceFieldDescription'

    NamespaceCreateRequest:
      type: object
      required:
        - name
        - description
      properties:
        name:
          $ref: '#/components/schemas/NamespaceFieldName'
        description:
          $ref: '#/components/schemas/NamespaceFieldDescription'

    NamespaceUpdateRequest:
      type: object
      properties:
        name:
          $ref: '#/components/schemas/NamespaceFieldName'
        description:
          $ref: '#/components/schemas/NamespaceFieldDescription'

    ############################
    # UserInfo:
    ############################
    UserRoleDto:
      type: object
      required:
        - subject
        - assignerSubject
      properties:
        subject:
          type: string
          format: uuid
        assignerSubject:
          type: string
          format: uuid
        username:
          type: string
        firstName:
          type: string
        lastName:
          type: string

    ############################
    # Applications:
    ############################
    PagedModelApplicationDto:
      type: object
      required:
        - content
        - page
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/ApplicationDto'
        page:
          $ref: '#/components/schemas/PageMetadata'

    ApplicationFieldName:
      type: string
      minLength: 1
      maxLength: 64

    ApplicationFieldDescription:
      type: string
      minLength: 0
      maxLength: 512

    ApplicationDto:
      type: object
      required:
        - id
        - namespaceId
        - name
        - description
        - creationByService
      properties:
        id:
          type: integer
          format: int64
        namespaceId:
          type: integer
          format: int64
        name:
          $ref: '#/components/schemas/ApplicationFieldName'
        description:
          $ref: '#/components/schemas/ApplicationFieldDescription'
        creationByService:
          type: boolean

    ApplicationCreateRequest:
      type: object
      required:
        - name
        - description
        - creationByService
      properties:
        name:
          $ref: '#/components/schemas/ApplicationFieldName'
        description:
          $ref: '#/components/schemas/ApplicationFieldDescription'
        creationByService:
          type: boolean

    ApplicationUpdateRequest:
      type: object
      required:
        - content
        - page
      properties:
        name:
          $ref: '#/components/schemas/ApplicationFieldName'
        description:
          $ref: '#/components/schemas/ApplicationFieldDescription'
        creationByService:
          type: boolean

    ############################
    # Keycloak client:
    ############################
    KeycloakClientDto:
      type: object
      required:
        - clientId
        - secret
      properties:
        clientId:
          type: string
          minLength: 64
          maxLength: 64
        secret:
          type: string
          minLength: 64
          maxLength: 64

    ############################
    # Configurations:
    ############################
    SourceType:
      type: string
      enum:
        - USER
        - SERVICE

    ConfigurationFieldName:
      type: string
      minLength: 1
      maxLength: 64

    PagedModelConfigurationDto:
      type: object
      required:
        - content
        - page
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/ConfigurationDto'
        page:
          $ref: '#/components/schemas/PageMetadata'

    ConfigurationDto:
      type: object
      required:
        - id
        - namespaceId
        - applicationId
        - name
        - schemaSourceType
      properties:
        id:
          type: integer
          format: int64
        namespaceId:
          type: integer
          format: int64
        applicationId:
          type: integer
          format: int64
        name:
          $ref: '#/components/schemas/ConfigurationFieldName'
        schemaSourceType:
          $ref: '#/components/schemas/SourceType'
        # nullable
        commitVersion:
          type: string
        commitId:
          type: integer
          format: int64

    ConfigurationDetailedDto:
      allOf:
        - $ref: '#/components/schemas/ConfigurationDto'
        - type: object
          properties:
            jsonValues:
              $ref: '#/components/schemas/ConfigurationJsonValues'
            jsonSchema:
              $ref: '#/components/schemas/ConfigurationJsonSchema'

    ConfigurationDtoCreateRequest:
      type: object
      required:
        - name
        - schemaSourceType
      properties:
        name:
          $ref: '#/components/schemas/ConfigurationFieldName'
        schemaSourceType:
          $ref: '#/components/schemas/SourceType'

    ConfigurationDtoUpdateRequest:
      type: object
      properties:
        name:
          $ref: '#/components/schemas/ConfigurationFieldName'
        schemaSourceType:
          $ref: '#/components/schemas/SourceType'

    ConfigurationCommitRequest:
      type: object
      required:
        - jsonValues
      properties:
        jsonValues:
          $ref: '#/components/schemas/ConfigurationJsonValues'
        # nullable
        jsonSchema:
          $ref: '#/components/schemas/ConfigurationJsonSchema'

    ConfigurationJsonValues:
      description: Configuration json
      type: string

    ConfigurationJsonSchema:
      description: Configuration json schema
      type: string

    PagedModelConfigurationCommitDto:
      type: object
      required:
        - content
        - page
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/ConfigurationCommitDto'
        page:
          $ref: '#/components/schemas/PageMetadata'

    ConfigurationCommitDto:
      type: object
      required:
        - namespaceId
        - applicationId
        - configurationId
        - commitId
        - commitVersion
        - sourceType
        - sourceIdentity
      properties:
        namespaceId:
          type: integer
          format: int64
        applicationId:
          type: integer
          format: int64
        configurationId:
          type: integer
          format: int64
        commitId:
          type: integer
          format: int64
        commitVersion:
          type: string
        sourceType:
          $ref: '#/components/schemas/SourceType'
        sourceIdentity:
          type: string

    ConfigurationCommitDetailedDto:
      allOf:
        - $ref: '#/components/schemas/ConfigurationCommitDto'
        - type: object
          required:
            - jsonSchema
            - jsonValues
          properties:
            jsonSchema:
              $ref: '#/components/schemas/ConfigurationJsonSchema'
            jsonValues:
              $ref: '#/components/schemas/ConfigurationJsonValues'
